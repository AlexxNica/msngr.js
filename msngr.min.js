var msngr=msngr||function(){"use strict";var a={},b=function(){var b=Array.prototype.slice.call(arguments,0);return a.message.apply(this,b)};return b.version="5.0.0",b.extend=function(c){if(void 0!==c&&null!==c){var d=Object.prototype.toString.call(c);if("[object Function]"===d)return c.apply(this,[b,a])}},Object.defineProperty(b,"debug",{set:function(c){c===!0?b.internal=a:c===!1&&delete b.internal},get:function(){return void 0!==b.internal}}),b}();msngr.extend(function(a,b){"use strict";b.InvalidParametersException=function(b,c){var d={name:"InvalidParametersException",severity:"unrecoverable",message:"Invalid parameters supplied to the {method} method".replace("{method}",b)};return a.is(c).empty||(d.message=d.message+" "+c),d},b.ReservedKeywordsException=function(a){return{name:"ReservedKeywordsException",severity:"unrecoverable",message:"Reserved keyword {keyword} supplied as action.".replace("{keyword}",a)}},b.MangledException=function(a,b){return{name:"MangledException",severity:"unrecoverable",message:"The {variable} was unexpectedly mangled in {method}.".replace("{variable}",a).replace("{method}",b)}}}),msngr.extend(function(a,b){"use strict";var c={arguments:"[object Arguments]","boolean":"[object Boolean]",string:"[object String]",date:"[object Date]",array:"[object Array]",number:"[object Number]",object:"[object Object]","function":"[object Function]",undefined:"[object Undefined]","null":"[object Null]",symbol:"[object Symbol]",promise:"[object Promise]",nodelist:"[object NodeList]"},d={htmlElement:function(a){return 0===a.indexOf("[object HTML")||0===a.indexOf("[object global]")}},e=function(a){return Object.prototype.toString.call(a)},f=function(a,b,f){return f?d[a](e(b)):e(b)===c[a]},g=function(a,b){switch(a){case c.undefined:case c["null"]:return!0;case c.string:return 0===b.trim().length;case c.object:return 0===Object.keys(b).length;case c.array:return 0===b.length;default:return!1}},h=function(a){var b={},h=function(c,d){for(var e in c)c.hasOwnProperty(e)&&!function(c){Object.defineProperty(b,c,{get:function(){for(var b=0;b<a.length;++b)if(!f(c,a[b],d))return!1;return!0}})}(e)};return h(c,!1),h(d,!0),Object.defineProperty(b,"there",{get:function(){for(var b=0;b<a.length;++b)if(void 0===a[b]||null===a[b])return!1;return!0}}),Object.defineProperty(b,"empty",{get:function(){for(var b=0;b<a.length;++b)if(!g(e(a[b]),a[b]))return!1;return!0}}),b};b.types=c,a.is=function(){var a=Array.prototype.slice.call(arguments,0),b=h(a);return b.getType=function(){return Object.prototype.toString.call(a[0])},b.getTypes=function(){for(var b=[],c=0;c<a.length;++c)b.push(Object.prototype.toString.call(a[c]));return b},b},a.is.browser="undefined"!=typeof XMLHttpRequest}),msngr.extend(function(a,b){"use strict";a.deDupeArray=function(a){for(var b={},c=[],d=a.length,e=0;d>e;++e)void 0===b[a[e]]&&(b[a[e]]=!0,c.push(a[e]));return c}}),msngr.extend(function(a,b){"use strict";var c=0,d="Mxxx".replace(/[x]/g,function(){return Math.floor(100*Math.random())});a.id=function(){return++c,d+c},a.uuid=function(){var b=a.now(),c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=(b+16*Math.random())%16|0;return b=Math.floor(b/16),("x"==a?c:3&c|8).toString(16)});return c}}),msngr.extend(function(a,b){"use strict";var c;if("undefined"!=typeof window&&"undefined"!=typeof window.postMessage){var d="__msngr_immediate",e=[];window.addEventListener("message",function(a){a.source===window&&a.data===d&&(a.stopPropagation(),e.length>0&&e.shift()())},!0)}a.immediate=function(b){void 0===c&&(c="undefined"!=typeof setImmediate?setImmediate:"undefined"!=typeof window&&"undefined"!=typeof window.postMessage?function(b){e.push(b),window.postMessage(a.config.get("msngr.immediate").channel,"*")}:function(a){setTimeout(a,0)}),c(b)}}),msngr.extend(function(a,b){"use strict";var c=void 0,d="",e=void 0,f=function(){return performance.now()},g=function(){return process.hrtime()[1]/1e6},h=function(){return Date.now()};a.now=function(b){void 0===c&&("undefined"!=typeof performance?(c=f,d="performance"):"undefined"!=typeof process?(c=g,d="node"):(c=h,d="legacy"));var i=c();return b===!0&&e===i?a.now(b):(e=i,i)}}),msngr.extend(function(a,b){"use strict";a.asyncify=function(b){return a.is(b)["function"]&&(b.async=function(){var c=[].slice.call(arguments),d=c.pop();a.is(d)["function"]&&!function(c,d){a.immediate(function(){try{d.apply(null,[null,b.apply(null,c)])}catch(a){d.apply(null,[a,null])}})}(c,d)}),b}}),msngr.extend(function(a,b){"use strict";var c={};c[b.types.string]=function(a){return a},c[b.types.number]=function(a){return a},c[b.types["boolean"]]=function(a){return a},c[b.types.date]=function(a){var b=new Date;return b.setTime(a.getTime()),b},c[b.types.object]=function(b){var c={};for(var d in b)b.hasOwnProperty(d)&&(c[d]=a.copy(b[d]));return c},c[b.types.array]=function(b){for(var c=[],d=0;d<b.length;d++)c[d]=a.copy(b[d]);return c},c[b.types["function"]]=function(b){var c=b.bind({});for(var d in b)b.hasOwnProperty(d)&&(c[d]=a.copy(b[d]));return c},a.copy=function(b){if(void 0===b||null===b)return b;var d=a.is(b).getType();return void 0!==c[d]?c[d](b):b}}),msngr.extend(function(a,b){"use strict";var c=function(d,e){if(void 0===d||null===d)return e;if(void 0===e||null===e)return d;var f=a.is(d).getType(),g=a.is(e).getType(),h=[b.types.object,b.types["function"],b.types.array],i=[b.types.object,b.types.array];if(-1===h.indexOf(f)||-1===i.indexOf(g))throw b.InvalidParametersException("msngr.merge()","Only objects, arrays or a single function followed by objects can be merged!");if(-1!==[f,g].indexOf(b.types.array)&&(f!==b.types.array||g!==b.types.array))throw b.InvalidParametersException("msngr.merge()","Arrays cannot be merged with objects or functions!");var j=d;if(f===b.types.array&&g===b.types.array)return d.concat(e);for(var k in e)if(e.hasOwnProperty(k)){var l=a.is(e[k]);l.object?(j[k]=j[k]||{},j[k]=c(j[k],e[k])):l.array?(j[k]=j[k]||[],j[k]=j[k].concat(e[k])):j[k]=e[k]}return j};a.merge=function(){var a=Array.prototype.slice.call(arguments,0);if(a.length<=1)return a[0];for(var b=a.shift();a.length>0;)b=c(b,a.shift());return b}}),msngr.extend(function(a,b){"use strict";a.safe=function(c,d,e){if(!a.is(c).object||!a.is(d).string)throw b.InvalidParametersException("msngr.safe");for(var f=d.split("."),g=c,h=void 0;(h=f.shift())&&(g=g[h],void 0!==g););return g||e}}),msngr.extend(function(a,b){"use strict";b.executer=function(c){var d=a.is(c);if(!d.there||!d.array)throw b.InvalidParametersException("executor");for(var e=0;e<c.length;++e)a.is(c[e])["function"]&&(c[e]={method:c[e]});var f=function(b,c,d,e){var f=a.is(c);a.immediate(function(){var a=!1,g=function(){return a=!0,function(a){e.apply(d,[a])}};f.array||(c=f.there?[c]:[]),c.push(g);var h=b.apply(d||this,c);a!==!0&&e.apply(d,[h])})};return{parallel:function(b){var d=a.is(b),e=[],g=0;if(0===c.length&&d.there)return b.apply(k,[[]]);for(var h=0;h<c.length;++h){var i=c[h].method,j=c[h].params,k=c[h].context;!function(h,i,j){f(h,i,j,function(f){a.is(f).there&&e.push(f),++g,g===c.length&&d.there&&b.apply(k,[e])})}(i,j,k)}}}}}),msngr.extend(function(a,b){"use strict";var c=function(a){return void 0!==a&&null!==a},d=function(a,b){var c=a.indexOf(b),d=a.length-1;if(c!==d){var e=a[d];a[d]=a[c],a[c]=e}a.pop()};b.memory=function(){var b={},e={},f=0,g={index:function(d){if(c(d)&&c(d.topic)){var g=a.id();return b[g]=a.copy(d),c(e[d.topic])||(e[d.topic]={ids:[],category:{}}),c(e[d.topic].category[d.category])||(e[d.topic].category[d.category]={ids:[],subcategory:{}}),c(e[d.topic].category[d.category].subcategory[d.subcategory])||(e[d.topic].category[d.category].subcategory[d.subcategory]={ids:[]}),c(d.category)||c(d.subcategory)||e[d.topic].ids.push(g),c(d.category)&&!c(d.subcategory)&&e[d.topic].category[d.category].ids.push(g),c(d.category)&&c(d.subcategory)&&e[d.topic].category[d.category].subcategory[d.subcategory].ids.push(g),f++,g}},"delete":function(a){if(c(a)&&c(b[a])){var g=b[a];return d(e[g.topic].ids,a),d(e[g.topic].category[g.category].ids,a),d(e[g.topic].category[g.category].subcategory[g.subcategory].ids,a),delete b[a],f--,!0}return!1},query:function(b){var d=[];if(c(b)&&c(b.topic)&&c(e[b.topic])){var f=e[b.topic],g=((f||{}).category||{})[b.category],h=((g||{}).subcategory||{})[b.subcategory];d=d.concat(f.ids||[]),d=d.concat((g||{}).ids||[]),d=d.concat((h||{}).ids||[])}return a.deDupeArray(d)},clear:function(){return b={},e={},f=0,!0}};return Object.defineProperty(g,"count",{get:function(){return f}}),g}}),msngr.extend(function(a,b){"use strict";b.option=function(a,c){b.option[a]=c};var c=b.memory(),d=b.memory(),e={},f=0,g={},h=0;return Object.defineProperty(b,"handlerCount",{get:function(){return f}}),Object.defineProperty(b,"payloadCount",{get:function(){return h}}),b.reset=function(){e={},f=0,c.clear(),d.clear(),g={},h=0},b.processOpts=function(c,d,e,f){var g=[];for(var h in c)c.hasOwnProperty(h)&&a.is(b.option[h]).there&&g.push({method:b.option[h],params:[d,e,c]});if(0===g.length)return f.apply(this,[e]);var i=b.executer(g);i.parallel(function(b){var c=e;if(a.is(b).there&&b.length>0)for(var d=0;d<b.length;++d)a.is(b[d]).there&&(c=a.merge(b[d],c));f.apply(this,[c])})},b.message=function(i,j,k){var l=a.is(i),m=a.is(j),n=a.is(k);if(!l.there)throw b.InvalidParametersException("msngr()");if(!l.object&&!l.string)throw b.InvalidParametersException("msngr()");if(l.empty)throw b.InvalidParametersException("msngr()");var o;l.object?o=a.copy(i):(o={},o.topic=i,m.empty||(o.category=j),n.empty||(o.subcategory=k));for(var p in o)o.hasOwnProperty(p)&&(o[p]=o[p].toLowerCase());var q={},r={emits:0,persists:0,options:0,ons:0,onces:0},s=function(a,d,f){var d=d||c.query(o)||[];b.processOpts(q,o,a,function(a){for(var c=[],g=[],h=0;h<d.length;++h){var i=e[d[h]];c.push({method:i.handler,params:[a,o]}),i.once===!0&&g.push(i.handler)}for(var j=b.executer(c),h=0;h<g.length;++h)u.drop(g[h]);j.parallel(f)})},t=function(){var b,c=d.query(o);if(0!==c.length){if(1===c.length)return g[c[0]];for(var e=0;e<c.length;++e)b=a.merge(innerPay,b);return b}},u={option:function(c,d){var e=a.is(c);if(!e.there||!e.string)throw b.InvalidParametersException("option");return q[c]=d,r.options=r.options+1,u},emit:function(b,c){var d=a.is(b);return d["function"]&&(c=b,b=void 0),s(b,void 0,c),r.emits=r.emits+1,u},persist:function(b){void 0===b&&(b=null);var c=d.query(o);if(0===c.length){var e=d.index(o);g[e]=b,c=[e]}else for(var f=0;f<c.length;++f)g[c[f]]=a.merge(b,g[c[f]]);var i=t();return++h,r.persists=r.persists+1,u.emit(i)},cease:function(){for(var a=d.query(o),b=0;b<a.length;++b)delete g[a[b]],--h;return u},on:function(a){var b=c.index(o);e[b]={handler:a,context:o.context||this,once:!1},f++;var d=t();return void 0!==d&&s(d,[b],void 0),r.ons=r.ons+1,u},once:function(a){var b=c.index(o);e[b]={handler:a,context:o.context||this,once:!0},f++;var d=t();return void 0!==d&&s(d,[b],void 0),r.onces=r.onces+1,u},drop:function(a){var b=c.query(o);if(b.length>0)for(var d=0;d<b.length;++d){var g=b[d];e[g].handler===a&&(delete e[g],f--,c["delete"](g))}return u},dropAll:function(){var a=c.query(o);if(a.length>0)for(var b=0;b<a.length;++b){var d=a[b];delete e[d],f--,c["delete"](d)}return u}};return Object.defineProperty(u,"message",{get:function(){return o}}),Object.defineProperty(u,"topic",{get:function(){return o.topic}}),Object.defineProperty(u,"category",{get:function(){return o.category}}),Object.defineProperty(u,"subcategory",{get:function(){return o.subcategory}}),Object.defineProperty(u,"subscribers",{get:function(){return c.query(o).length}}),a.debug===!0&&Object.defineProperty(u,"counts",{get:function(){return r}}),u},{}}),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=msngr);