var msngr=msngr||function(){"use strict";var a={},b=function(){var a=Array.prototype.slice.call(arguments,0);return b.message.apply(this,a)};return b.version="5.0.0",b.extend=function(c){if(void 0!==c&&null!==c){var d=Object.prototype.toString.call(c);if("[object Function]"===d)return c.apply(this,[b,a])}},Object.defineProperty(b,"debug",{set:function(c){c===!0?b.internal=a:c===!1&&delete b.internal},get:function(){return void 0!==b.internal}}),b}();msngr.extend(function(a,b){"use strict";b.InvalidParametersException=function(b,c){var d={name:"InvalidParametersException",severity:"unrecoverable",message:"Invalid parameters supplied to the {method} method".replace("{method}",b)};return a.is(c).empty||(d.message=d.message+" "+c),d},b.DuplicateException=function(a){return{name:"DuplicateException",severity:"unrecoverable",message:"Duplicate input provided to {method} where duplicates are not allowed.".replace("{method}",a)}},b.ReservedKeywordsException=function(a){return{name:"ReservedKeywordsException",severity:"unrecoverable",message:"Reserved keyword {keyword} supplied as action.".replace("{keyword}",a)}},b.MangledException=function(a,b){return{name:"MangledException",severity:"unrecoverable",message:"The {variable} was unexpectedly mangled in {method}.".replace("{variable}",a).replace("{method}",b)}}}),msngr.extend(function(a,b){"use strict";var c={arguments:"[object Arguments]","boolean":"[object Boolean]",string:"[object String]",date:"[object Date]",array:"[object Array]",number:"[object Number]",object:"[object Object]","function":"[object Function]",undefined:"[object Undefined]","null":"[object Null]",symbol:"[object Symbol]",promise:"[object Promise]",nodelist:"[object NodeList]"},d={htmlElement:function(a){return 0===a.indexOf("[object HTML")||0===a.indexOf("[object global]")}},e=function(a){return Object.prototype.toString.call(a)},f=function(a,b,f){return f?d[a](e(b)):e(b)===c[a]},g=function(a,b){switch(a){case c.undefined:case c["null"]:return!0;case c.string:return 0===b.trim().length;case c.object:return 0===Object.keys(b).length;case c.array:return 0===b.length;default:return!1}},h=function(a){var b={},h=function(c,d){for(var e in c)c.hasOwnProperty(e)&&!function(c){Object.defineProperty(b,c,{get:function(){for(var b=0;b<a.length;++b)if(!f(c,a[b],d))return!1;return!0}})}(e)};return h(c,!1),h(d,!0),Object.defineProperty(b,"there",{get:function(){for(var b=0;b<a.length;++b)if(void 0===a[b]||null===a[b])return!1;return!0}}),Object.defineProperty(b,"empty",{get:function(){for(var b=0;b<a.length;++b)if(!g(e(a[b]),a[b]))return!1;return!0}}),b};b.types=c,a.is=function(){var a=Array.prototype.slice.call(arguments,0),b=h(a);return b.getType=function(){return Object.prototype.toString.call(a[0])},b.getTypes=function(){for(var b=[],c=0;c<a.length;++c)b.push(Object.prototype.toString.call(a[c]));return b},b},a.is.browser="undefined"!=typeof XMLHttpRequest}),msngr.extend(function(a,b){"use strict";a.deDupeArray=function(a){for(var b={},c=[],d=a.length,e=0;d>e;++e)void 0===b[a[e]]&&(b[a[e]]=!0,c.push(a[e]));return c}}),msngr.extend(function(a,b){"use strict";var c=0,d="Mxxx".replace(/[x]/g,function(){return Math.floor(100*Math.random())});a.id=function(){return++c,d+c},a.uuid=function(){var b=a.now(),c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=(b+16*Math.random())%16|0;return b=Math.floor(b/16),("x"==a?c:3&c|8).toString(16)});return c}}),msngr.extend(function(a,b){"use strict";var c;if("undefined"!=typeof window&&"undefined"!=typeof window.postMessage){var d="__msngr_immediate",e=[];window.addEventListener("message",function(a){a.source===window&&a.data===d&&(a.stopPropagation(),e.length>0&&e.shift()())},!0)}a.immediate=function(b){void 0===c&&(c="undefined"!=typeof setImmediate?setImmediate:"undefined"!=typeof window&&"undefined"!=typeof window.postMessage?function(b){e.push(b),window.postMessage(a.config.get("msngr.immediate").channel,"*")}:function(a){setTimeout(a,0)}),c(b)}}),msngr.extend(function(a,b){"use strict";var c=void 0,d="",e=void 0,f=function(){return performance.now()},g=function(){return process.hrtime()[1]/1e6},h=function(){return Date.now()};a.now=function(b){void 0===c&&("undefined"!=typeof performance?(c=f,d="performance"):"undefined"!=typeof process?(c=g,d="node"):(c=h,d="legacy"));var i=c();return b===!0&&e===i?a.now(b):(e=i,i)}}),msngr.extend(function(a,b){"use strict";a.asyncify=function(b){return a.is(b)["function"]&&(b.async=function(){var c=[].slice.call(arguments),d=c.pop();a.is(d)["function"]&&!function(c,d){a.immediate(function(){try{d.apply(null,[null,b.apply(null,c)])}catch(a){d.apply(null,[a,null])}})}(c,d)}),b}}),msngr.extend(function(a,b){"use strict";var c={};c[b.types.string]=function(a){return a},c[b.types.number]=function(a){return a},c[b.types["boolean"]]=function(a){return a},c[b.types.date]=function(a){var b=new Date;return b.setTime(a.getTime()),b},c[b.types.object]=function(b){var c={};for(var d in b)b.hasOwnProperty(d)&&(c[d]=a.copy(b[d]));return c},c[b.types.array]=function(b){for(var c=[],d=0;d<b.length;d++)c[d]=a.copy(b[d]);return c},c[b.types["function"]]=function(b){var c=b.bind({});for(var d in b)b.hasOwnProperty(d)&&(c[d]=a.copy(b[d]));return c},a.copy=function(b){if(void 0===b||null===b)return b;var d=a.is(b).getType();return void 0!==c[d]?c[d](b):b}}),msngr.extend(function(a,b){"use strict";var c=function(d,e){if(void 0===d||null===d)return e;if(void 0===e||null===e)return d;var f=a.is(d).getType(),g=a.is(e).getType(),h=[b.types.object,b.types["function"],b.types.array],i=[b.types.object,b.types.array];if(-1===h.indexOf(f)||-1===i.indexOf(g))throw b.InvalidParametersException("msngr.merge()","Only objects, arrays or a single function followed by objects can be merged!");if(-1!==[f,g].indexOf(b.types.array)&&(f!==b.types.array||g!==b.types.array))throw b.InvalidParametersException("msngr.merge()","Arrays cannot be merged with objects or functions!");var j=d;if(f===b.types.array&&g===b.types.array)return d.concat(e);for(var k in e)if(e.hasOwnProperty(k)){var l=a.is(e[k]);l.object?(j[k]=j[k]||{},j[k]=c(j[k],e[k])):l.array?(j[k]=j[k]||[],j[k]=j[k].concat(e[k])):j[k]=e[k]}return j};a.merge=function(){var a=Array.prototype.slice.call(arguments,0);if(a.length<=1)return a[0];for(var b=a.shift();a.length>0;)b=c(b,a.shift());return b}}),msngr.extend(function(a,b){"use strict";a.safe=function(c,d,e){if(!a.is(c).object||!a.is(d).string)throw b.InvalidParametersException("msngr.safe");for(var f=d.split("."),g=c,h=void 0;(h=f.shift())&&(g=g[h],void 0!==g););return a.is(g).there?g:e}}),msngr.extend(function(a,b){"use strict";b.executer=function(b){for(var c=0;c<b.length;++c)a.is(b[c])["function"]&&(b[c]={method:b[c]});var d=function(b,c,d,e){var f=a.is(c);a.immediate(function(){var a=!1,g=function(){return a=!0,function(a){e.apply(d,[a])}};f.array||(c=f.there?[c]:[]),c.push(g);var h=b.apply(d||this,c);a!==!0&&e.apply(d,[h])})};return{parallel:function(c){var e=a.is(c),f=[],g=0;if(0===b.length&&e.there)return c.apply(k,[[]]);for(var h=0;h<b.length;++h){var i=b[h].method,j=b[h].params,k=b[h].context;!function(h,i,j){d(h,i,j,function(d){a.is(d).there&&f.push(d),++g,g===b.length&&e.there&&c.apply(k,[f])})}(i,j,k)}},series:function(c){var e=a.is(c),f=[];if(0===b.length&&e.there)return c.apply(context,[[]]);var g=function(){var h=b.shift();!function(h,i,j){d(h,i,j,function(d){a.is(d).there&&f.push(d),0===b.length&&e.there?c.apply(context,[f]):g()})}(h.method,h.params,h.context)};g()}}}}),msngr.extend(function(a,b){"use strict";var c=function(a){return void 0!==a&&null!==a},d=function(a,b){var c=a.indexOf(b),d=a.length-1;if(c!==d){var e=a[d];a[d]=a[c],a[c]=e}a.pop()};b.memory=function(){var b={},e={},f=0,g={index:function(d){if(c(d)&&c(d.topic)){var g=a.id();return b[g]=a.copy(d),c(e[d.topic])||(e[d.topic]={ids:[],category:{}}),c(e[d.topic].category[d.category])||(e[d.topic].category[d.category]={ids:[],subcategory:{}}),c(e[d.topic].category[d.category].subcategory[d.subcategory])||(e[d.topic].category[d.category].subcategory[d.subcategory]={ids:[]}),c(d.category)||c(d.subcategory)||e[d.topic].ids.push(g),c(d.category)&&!c(d.subcategory)&&e[d.topic].category[d.category].ids.push(g),c(d.category)&&c(d.subcategory)&&e[d.topic].category[d.category].subcategory[d.subcategory].ids.push(g),f++,g}},getById:function(a){return b[a]},"delete":function(a){if(c(a)&&c(b[a])){var g=b[a];return d(e[g.topic].ids,a),d(e[g.topic].category[g.category].ids,a),d(e[g.topic].category[g.category].subcategory[g.subcategory].ids,a),delete b[a],f--,!0}return!1},query:function(b){var d=[];if(c(b)&&c(b.topic)&&c(e[b.topic])){var f=e[b.topic],g=((f||{}).category||{})[b.category],h=((g||{}).subcategory||{})[b.subcategory];d=d.concat(f.ids||[]),d=d.concat((g||{}).ids||[]),d=d.concat((h||{}).ids||[])}return a.deDupeArray(d)},clear:function(){return b={},e={},f=0,!0}};return Object.defineProperty(g,"count",{get:function(){return f}}),g}}),msngr.extend(function(a,b){"use strict";var c=b.memory(),d=b.memory(),e={},f=0,g={},h=0;Object.defineProperty(b,"handlerCount",{get:function(){return f}}),Object.defineProperty(b,"payloadCount",{get:function(){return h}}),b.reset=function(){e={},f=0,c.clear(),d.clear(),g={},h=0};var i=function(b){var c=d.query(b);if(0!==c.length){var e=g[c[0]];if(c.length>1)for(var f=1;f<c.length;++f)e=a.merge(innerPay,fpay);return e}},j=function(d,f,g){var h=a.is(d).array?d:c.query(d);if(h.length>0){for(var i=[],j=[],k=0;k<h.length;++k){var l=a.is(d).object?a.copy(d):a.copy(c.query(h[k])),m=e[h[k]];i.push({method:m.handler,params:[f,l]}),m.once===!0&&j.push({msg:l,handler:m.handler})}for(var n=b.executer(i),k=0;k<j.length;++k)a(j[k].msg).drop(j[k].handler);n.parallel(g)}};a.message=function(k,l,m){var n=a.is(k),o=a.is(l),p=a.is(m);if(!n.there)throw b.InvalidParametersException("msngr()");if(!n.object&&!n.string)throw b.InvalidParametersException("msngr()");if(n.empty)throw b.InvalidParametersException("msngr()");var q;n.object?q=a.copy(k):(q={},q.topic=k,o.empty||(q.category=l),p.empty||(q.subcategory=m));for(var r in q)q.hasOwnProperty(r)&&(q[r]=q[r].toLowerCase());var s={emit:function(b,c){var d=a.is(b);return d["function"]&&(c=b,b=void 0),j(q,b,c),s},persist:function(b){void 0===b&&(b=null);var c=d.query(q);if(0===c.length){var e=d.index(q);g[e]=b,c=[e]}else for(var f=0;f<c.length;++f)g[c[f]]=a.merge(b,g[c[f]]);return++h,s.emit(i(q))},cease:function(){for(var a=d.query(q),b=0;b<a.length;++b)delete g[a[b]],--h;return s},on:function(a){var b=c.index(q);e[b]={handler:a,context:q.context||this,once:!1},f++;var d=i(q);return void 0!==d&&j([b],d,void 0),s},once:function(a){var b=c.index(q);e[b]={handler:a,context:q.context||this,once:!0},f++;var d=i(q);return void 0!==d&&j([b],d,void 0),s},drop:function(a){var b=c.query(q);if(b.length>0)for(var d=0;d<b.length;++d){var g=b[d];e[g].handler===a&&(delete e[g],f--,c["delete"](g))}return s},dropAll:function(){var a=c.query(q);if(a.length>0)for(var b=0;b<a.length;++b){var d=a[b];delete e[d],f--,c["delete"](d)}return s}};return Object.defineProperty(s,"message",{get:function(){return q}}),Object.defineProperty(s,"topic",{get:function(){return q.topic}}),Object.defineProperty(s,"category",{get:function(){return q.category}}),Object.defineProperty(s,"subcategory",{get:function(){return q.subcategory}}),Object.defineProperty(s,"handlers",{get:function(){return c.query(q).length}}),s}}),msngr.extend(function(a,b){"use strict";var c={},d=[];b.getMiddleware=function(a){for(var b=[],e=a.concat(d),f=0;f<e.length;++f)b.push(c[key]);return b},a.middleware=function(e,f,g){var h=a.is(e),i=a.is(f);if(!h.there||!h.string||h.empty||!i.there||!i["function"])throw b.InvalidParametersException("msngr.middleware()");if(a.is(c[e]).there)throw b.DuplicateException("msngr.middleware()");c[e]=f,g===!0&&d.push(e)}}),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=msngr);